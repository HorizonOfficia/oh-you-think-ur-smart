<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spec1al web ports</title>
    <base href="https://cdn.jsdelivr.net/gh/HorizonOfficia/oh-you-think-ur-smart@latest/">
    <meta name="theme-color" content="#000000" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HorizonOfficia/oh-you-think-ur-smart@latest/utweb/style.css" />
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/HorizonOfficia/oh-you-think-ur-smart@latest/utweb/fav.ico" />
  </head>
  <body>
    <div class="container">
      <h1 class="shortpie">&nbsp;imspec1al's</h1>
      <br>
      <img style="margin: 0;" src="utweb/undertale_logo.jpg" alt="UNDERTALE" class="logo" />
      <h1>webport</h1>
      <audio id="audio-player" preload="auto"></audio>
      <div class="button-group">
          <div id="chapterButtons" class="chapter-buttons">
            <button id="10th" class="chapter-button-3">
              <span class="button-label">10TH ANNIVERSARY BATTLE (peak)</span>
            </button>
            <button id="play" class="chapter-button-1">
              <span class="button-label">UNDERTALE</span>
            </button>
            <button id="ostPlayerButton" class="chapter-button-2">
              <span class="button-label">MUSIC PLAYER</span>
            </button>
            <button id="drweb" class="chapter-button-1">
              <span class="button-label">DELTARUNE</span>
            </button>
            <button id="bossrush" class="chapter-button-3">
              <span class="button-label">BOSS RUSH (DELTARUNE)</span>
            </button>
            <button id="utyweb" class="chapter-button-1">
              <span class="button-label">UNDERTALE-YELLOW</span>
            </button>
			<button id="lastbreath" class="chapter-button-2">
              <span class="button-label">LAST BREATH</span>
            </button>
          </div>
      </div>
        <p>
        <br>so the original was made by this idiot named .shortpie right? welp he left a trace of a github repo that shouldnt exist so i forked it and edited the code and stuff. also type "pie" while in game for some custom features -math nerd<br>
        </p>
      <div id="gameFrame" class="game-frame hidden"></div>
      <script>
          async function loadthingy(url) {
            try {
                const res = await fetch(`${url}?t=${Date.now()}`);
                const html = await res.text();
                const newTab = window.open('about:blank#ergeiurn');
                newTab.document.open();
                newTab.document.write(html);
                newTab.document.close();
                newTab.focus();
                window.close();
            } catch (error) {
              console.error('Error loading page:', error);
            }
          }
          async function loadplay(url) {
              try {
                  const res = await fetch(`${url}?t=${Date.now()}`);
                  const html = await res.text();
                  const newTab = window.open('about:blank#wfwef');
                  if (!newTab) {
                      console.error("Popup blocked â€” user gesture not recognized");
                      return;
                  }
                  newTab.document.open();
                  newTab.document.write(html);
                  newTab.document.close();
                  newTab.focus();
                  window.close();
              } catch (error) {
                  console.error('Error loading page:', error);
              }
          }
          async function loadsomething(url) {
    try {
        // 1. Fetch the HTML from the CDN
        const res = await fetch(`${url}?t=${Date.now()}`);
        let html = await res.text();

        // 2. Identify the folder path (e.g., https://.../lastbreath/)
        const folderPath = url.substring(0, url.lastIndexOf("/") + 1);

        // 3. Inject the Fixes
        // This forces the C2 engine to look at the CDN for everything
        const injection = `
            <base href="${folderPath}">
            <script>
                window.cr_setProjectURL = function(u) { return "${folderPath}"; };
                // Redirect internal AJAX requests to the CDN folder
                const originalFetch = window.fetch;
                window.fetch = function(input, init) {
                    if (typeof input === 'string' && !input.startsWith('http')) {
                        input = "${folderPath}" + input;
                    }
                    return originalFetch(input, init);
                };
            <\/script>
        `;
        
        // Insert the injection right after the <head> tag
        html = html.replace("<head>", "<head>" + injection);

        // 4. Create a Blob (Virtual File)
        const blob = new Blob([html], { type: 'text/html' });
        const blobUrl = URL.createObjectURL(blob);

        // 5. Open in a new tab
        window.open(blobUrl, '_blank');

    } catch (error) {
        console.error('Error launching game:', error);
        // Fallback: if fetch fails, just try to open the URL directly
        window.open(url, '_blank');
    }
}
          document.getElementById('play').addEventListener('click', async () => {
              const requiredKey = "underverif";
              const requiredValue = "fea2fb654f17156a8393d060f5b8a2d3833fdf96325b698da7596c76a2d041e9";

              const storedValue = localStorage.getItem(requiredKey);


                  await loadplay("https://cdn.jsdelivr.net/gh/HorizonOfficia/oh-you-think-ur-smart@latest/utweb/play/index.html");
          });
          
          const base = document.querySelector('base')?.href || window.location.origin;
          document.getElementById('10th').addEventListener('click', () =>
            loadthingy(`${base}utweb/10th/index.html`)
          );
          document.getElementById('ostPlayerButton').addEventListener('click', () =>
            loadthingy(`${base}utweb/music/index.html`)
          );
          document.getElementById('drweb').addEventListener('click', () =>
            loadthingy(`${base}drweb/play/index.html`)
          );
          document.getElementById('bossrush').addEventListener('click', () =>
            loadthingy(`https://padlet-uploads-usc1.storage.googleapis.com/4422927521/eb7443423fedf7dde51e5a866934220a/bossrush.html`)
          );
          document.getElementById('utyweb').addEventListener('click', () =>
            loadthingy(`${base}utyweb/index.html`)
          );
		  document.getElementById('lastbreath').addEventListener('click', () =>
			loadthingy("https://cdn.jsdelivr.net/gh/HorizonOfficia/oh-you-think-ur-smart@latest/lastbreath/index.html")
          );
		</script>
  </body>
</html>